<!DOCTYPE html>
<html>
<head>
  <title>Health Dashboard</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    input, button { margin: 5px; padding: 8px; }
    .alert { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <h2>Login</h2>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>

  <h2>Submit Health Metric</h2>
  <input id="metricType" placeholder="temperature, heart_rate, blood_pressure">
  <input id="value" type="number" placeholder="Value">
  <input id="heartRate" type="number" placeholder="Heart Rate">
  <input id="systolic" type="number" placeholder="Systolic BP">
  <input id="diastolic" type="number" placeholder="Diastolic BP">
  <button onclick="submitMetric()">Submit</button>

  <h2>My Metrics</h2>
  <ul id="metricsList"></ul>

  <script>
    let token = '';

    async function login() {
      const res = await fetch('/api/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          email: document.getElementById('email').value,
          password: document.getElementById('password').value
        })
      });
      const data = await res.json();
      token = data.token;
      alert('Logged in!');
      loadMetrics();
    }

    async function submitMetric() {
      const body = {
        metricType: document.getElementById('metricType').value,
        value: parseFloat(document.getElementById('value').value),
        heart_rate: parseInt(document.getElementById('heartRate').value),
        blood_pressure_systolic: parseInt(document.getElementById('systolic').value),
        blood_pressure_diastolic: parseInt(document.getElementById('diastolic').value),
      };

      const res = await fetch('/api/metrics', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Authorization: `Bearer ${token}`
        },
        body: JSON.stringify(body)
      });

      const data = await res.json();
      alert('Metric saved!');
      loadMetrics();
    }

    async function loadMetrics() {
      const res = await fetch('/api/metrics', {
        headers: {
          Authorization: `Bearer ${token}`
        }
      });
      const data = await res.json();

      const list = document.getElementById('metricsList');
      list.innerHTML = '';
      data.forEach(metric => {
        const item = document.createElement('li');
        item.innerHTML = `
          ${metric.metric_type} = ${metric.value} 
          ${metric.alert ? `<span class="alert">⚠️ ${metric.alert}</span>` : ''}
        `;
        list.appendChild(item);
      });
    }
  </script>
</body>
</html>

